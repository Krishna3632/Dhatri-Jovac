<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Big Architecture - Multi-Device File Transfer System</title>
    <style>
      body {
        background: #f8fafc;
        font-family: 'Segoe UI', sans-serif;
        padding: 2rem;
        color: #111827;
      }
      pre.mermaid {
        background: #fff;
        border-radius: 10px;
        padding: 1rem;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
      }
      h2 {
        font-weight: 600;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <h2>ðŸš€ Full Architecture â€” Multi-Device File Transfer Ecosystem</h2>

    <pre class="mermaid">
flowchart TB

%% ============ CLIENTS ============
%% Apply quotes to node text with special chars like ( ) /
subgraph CLIENTS["ðŸ“± CLIENT DEVICES"]
  P1["ðŸ“± Phone 1 (Primary Uploader)"]
  P2["ðŸ“± Phone 2 (Parallel Uploader)"]
  P3["ðŸ’» Web/Desktop Client"]
  P4["ðŸ“± Phone 3 (Backup Uploader)"]
  QR[ðŸ”³ QR Scanner]

end

%% ============ EDGE LAYER ============
subgraph EDGE["ðŸŒ Networking Layer"]
  WS[("ðŸ”Œ WebSocket Channel")]
  API[âš™ï¸ FastAPI REST API]
end

%% ============ COORDINATOR BACKEND ============
%% Apply quotes to node text with special chars like + /
subgraph BACKEND["ðŸ§  Coordinator Backend"]
  Auth["ðŸ” JWT + QR Token Validator"]
  Redis[("ðŸ’¾ Redis - Session/Chunk Tracker")]
  Postgres[(ðŸ—„ï¸ PostgreSQL - Metadata)]
  Worker[ðŸ§© Celery Worker]
  Scheduler["ðŸ“Š Chunk Scheduler / Load Balancer"]
end

%% ============ STORAGE + BACKUP ============
%% Apply quotes to node text with special chars like + /
subgraph STORAGE["â˜ï¸ Cloud + Local Storage"]
  S3[(â˜ï¸ S3 Cloud Storage)]
  Local[("ðŸ’» Local Cache / Offline Uploads")]
  CDN[(ðŸŒ CDN Edge Caches)]
end

%% ============ MONITORING ============
%% Apply quotes to node text with special chars like &
subgraph MONITORING["ðŸ“ˆ Monitoring & Logging"]
  Prometheus[ðŸ“Š Prometheus Metrics]
  Loki[ðŸ“œ Loki Logs]
  Grafana[ðŸ“ˆ Grafana Dashboard]
end

%% ---------------- CONNECTIONS ----------------
%% Apply quotes to link text with special chars like &
P1 -->|create-session| API
P2 -->|"scan QR & join-session"| API
P3 -->|join-session| API
P4a -->|scan QR & join-session| API
QR --> API

API --> WS
API --> Auth
Auth --> Redis
API --> Scheduler
Scheduler --> Redis
Scheduler --> Worker

Worker --> S3
Worker --> Postgres
API --> Postgres
API --> Local
Local -->|sync when online| S3
S3 --> CDN

API --> Prometheus
Worker --> Loki
Prometheus --> Grafana
Loki --> Grafana

%% ---------------- STYLES ----------------
style CLIENTS fill:#ecfeff,stroke:#06b6d4,stroke-width:2px
style EDGE fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
style BACKEND fill:#fce7f3,stroke:#ec4899,stroke-width:2px
style STORAGE fill:#dcfce7,stroke:#22c55e,stroke-width:2px
style MONITORING fill:#ede9fe,stroke:#8b5cf6,stroke-width:2px
    </pre>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true, theme: "default" });
    </script>
  </body>
</html>